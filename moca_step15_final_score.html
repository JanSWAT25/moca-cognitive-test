<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoCA Step 15 - Final Score & Assessment Summary</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            max-width: 1200px;
            width: 100%;
            overflow: hidden;
            animation: slideIn 0.6s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .step-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            backdrop-filter: blur(10px);
        }

        .content {
            padding: 40px;
        }

        .step-title {
            font-size: 2.2em;
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 15px;
            justify-content: center;
        }

        .step-icon {
            background: linear-gradient(135deg, #3498db, #2ecc71);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
        }

        .total-score-display {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            margin: 30px 0;
            position: relative;
            overflow: hidden;
        }

        .total-score-display::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: scoreShimmer 6s infinite;
        }

        @keyframes scoreShimmer {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .score-number {
            font-size: 4em;
            font-weight: bold;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .score-label {
            font-size: 1.5em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .interpretation-panel {
            background: #f8f9fa;
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            border: 2px solid #e9ecef;
        }

        .interpretation-title {
            font-size: 1.6em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }

        .interpretation-content {
            font-size: 1.1em;
            line-height: 1.6;
            color: #34495e;
            text-align: center;
            padding: 20px;
            border-radius: 15px;
        }

        .interpretation-normal {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            border-left: 4px solid #28a745;
            color: #155724;
        }

        .interpretation-mild {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border-left: 4px solid #ffc107;
            color: #856404;
        }

        .interpretation-moderate {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            border-left: 4px solid #dc3545;
            color: #721c24;
        }

        .domain-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .domain-card {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .domain-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(52, 152, 219, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .domain-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.2);
        }

        .domain-card:hover::before {
            left: 100%;
        }

        .domain-name {
            font-size: 1em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .domain-score {
            font-size: 2.2em;
            font-weight: bold;
            margin-bottom: 5px;
            position: relative;
            z-index: 1;
        }

        .domain-max {
            font-size: 0.9em;
            color: #6c757d;
            position: relative;
            z-index: 1;
        }

        .score-excellent { color: #28a745; }
        .score-good { color: #17a2b8; }
        .score-warning { color: #ffc107; }
        .score-error { color: #dc3545; }

        .education-adjustment {
            background: linear-gradient(135deg, #d1ecf1, #bee5eb);
            border-left: 4px solid #17a2b8;
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 10px 10px 0;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 160px;
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .btn-secondary {
            background: #ecf0f1;
            color: #2c3e50;
        }

        .btn-success {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .summary-table {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin: 30px 0;
        }

        .table-header {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
            padding: 20px;
            font-size: 1.3em;
            font-weight: 600;
            text-align: center;
        }

        .table-content {
            padding: 0;
        }

        .table-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            padding: 15px 25px;
            border-bottom: 1px solid #e9ecef;
            transition: background 0.3s ease;
        }

        .table-row:hover {
            background: #f8f9fa;
        }

        .table-row:last-child {
            border-bottom: none;
            background: linear-gradient(135deg, #e8f4f8, #d6eef7);
            font-weight: 600;
        }

        .cell-domain {
            font-weight: 500;
            color: #2c3e50;
        }

        .cell-score {
            text-align: center;
            font-weight: 600;
        }

        .cell-max {
            text-align: center;
            color: #6c757d;
        }

        .recommendations {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 25px;
            margin: 30px 0;
            border-radius: 0 15px 15px 0;
        }

        .recommendations h3 {
            color: #856404;
            margin-bottom: 15px;
        }

        .recommendations ul {
            color: #856404;
            line-height: 1.6;
            padding-left: 20px;
        }

        .disclaimer {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 20px;
            margin: 30px 0;
            border-radius: 0 10px 10px 0;
            font-size: 0.95em;
            color: #721c24;
            line-height: 1.5;
        }

        .print-summary {
            background: #e9ecef;
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
            text-align: center;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            gap: 20px;
        }

        /* Animations */
        .bounce-in {
            animation: bounceIn 1s ease-out;
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .fade-in {
            animation: fadeIn 0.8s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }
            
            .step-title {
                font-size: 1.8em;
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
            
            .domain-breakdown {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .table-row {
                grid-template-columns: 1.5fr 1fr 1fr;
                padding: 12px 15px;
                font-size: 0.9em;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .navigation {
                flex-direction: column;
            }
            
            .score-number {
                font-size: 3em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="step-badge">Step 15 of 15</div>
            <h1>📊 Final Assessment Results</h1>
            <p>Montreal Cognitive Assessment (MoCA) Summary</p>
        </div>

        <div class="content">
            <div class="step-title">
                <div class="step-icon">📊</div>
                Complete MoCA Score & Interpretation
            </div>

            <div class="total-score-display bounce-in">
                <div class="score-number" id="totalScore">26</div>
                <div class="score-label">Total MoCA Score (out of 30)</div>
            </div>

            <div class="education-adjustment" id="educationAdjustment">
                <h4 style="color: #0c5460; margin-bottom: 10px;">📚 Education Adjustment</h4>
                <p style="color: #0c5460;">
                    <span id="educationText">Add 1 point if ≤ 12 years education</span><br>
                    <strong>Adjusted Score: <span id="adjustedScore">26</span>/30</strong>
                </p>
            </div>

            <div class="interpretation-panel fade-in">
                <div class="interpretation-title">Clinical Interpretation</div>
                <div class="interpretation-content interpretation-normal" id="interpretationContent">
                    <strong>Normal Cognitive Function</strong><br>
                    Score ≥ 26 indicates normal cognitive performance. No significant cognitive impairment detected.
                </div>
            </div>

            <div class="summary-table fade-in">
                <div class="table-header">
                    Cognitive Domain Breakdown
                </div>
                <div class="table-content">
                    <div class="table-row">
                        <div class="cell-domain"><strong>Cognitive Domain</strong></div>
                        <div class="cell-score"><strong>Score</strong></div>
                        <div class="cell-max"><strong>Max</strong></div>
                    </div>
                    <div class="table-row">
                        <div class="cell-domain">Visuospatial/Executive</div>
                        <div class="cell-score" id="visuospatialScore">5</div>
                        <div class="cell-max">5</div>
                    </div>
                    <div class="table-row">
                        <div class="cell-domain">Naming</div>
                        <div class="cell-score" id="namingScore">3</div>
                        <div class="cell-max">3</div>
                    </div>
                    <div class="table-row">
                        <div class="cell-domain">Memory (Registration)</div>
                        <div class="cell-score" id="memoryScore">0</div>
                        <div class="cell-max">0</div>
                    </div>
                    <div class="table-row">
                        <div class="cell-domain">Attention</div>
                        <div class="cell-score" id="attentionScore">6</div>
                        <div class="cell-max">6</div>
                    </div>
                    <div class="table-row">
                        <div class="cell-domain">Language</div>
                        <div class="cell-score" id="languageScore">3</div>
                        <div class="cell-max">3</div>
                    </div>
                    <div class="table-row">
                        <div class="cell-domain">Abstraction</div>
                        <div class="cell-score" id="abstractionScore">2</div>
                        <div class="cell-max">2</div>
                    </div>
                    <div class="table-row">
                        <div class="cell-domain">Delayed Recall</div>
                        <div class="cell-score" id="delayedRecallScore">5</div>
                        <div class="cell-max">5</div>
                    </div>
                    <div class="table-row">
                        <div class="cell-domain">Orientation</div>
                        <div class="cell-score" id="orientationScore">6</div>
                        <div class="cell-max">6</div>
                    </div>
                    <div class="table-row">
                        <div class="cell-domain"><strong>TOTAL SCORE</strong></div>
                        <div class="cell-score" id="finalTotalScore"><strong>30</strong></div>
                        <div class="cell-max"><strong>30</strong></div>
                    </div>
                </div>
            </div>

            <div class="domain-breakdown fade-in">
                <div class="domain-card">
                    <div class="domain-name">Visuospatial/Executive</div>
                    <div class="domain-score score-excellent" id="domainVisuo">5</div>
                    <div class="domain-max">out of 5</div>
                </div>
                <div class="domain-card">
                    <div class="domain-name">Naming</div>
                    <div class="domain-score score-excellent" id="domainNaming">3</div>
                    <div class="domain-max">out of 3</div>
                </div>
                <div class="domain-card">
                    <div class="domain-name">Attention</div>
                    <div class="domain-score score-excellent" id="domainAttention">6</div>
                    <div class="domain-max">out of 6</div>
                </div>
                <div class="domain-card">
                    <div class="domain-name">Language</div>
                    <div class="domain-score score-excellent" id="domainLanguage">3</div>
                    <div class="domain-max">out of 3</div>
                </div>
                <div class="domain-card">
                    <div class="domain-name">Abstraction</div>
                    <div class="domain-score score-excellent" id="domainAbstraction">2</div>
                    <div class="domain-max">out of 2</div>
                </div>
                <div class="domain-card">
                    <div class="domain-name">Delayed Recall</div>
                    <div class="domain-score score-excellent" id="domainRecall">5</div>
                    <div class="domain-max">out of 5</div>
                </div>
                <div class="domain-card">
                    <div class="domain-name">Orientation</div>
                    <div class="domain-score score-excellent" id="domainOrientation">6</div>
                    <div class="domain-max">out of 6</div>
                </div>
            </div>

            <div class="recommendations fade-in">
                <h3>Clinical Recommendations</h3>
                <ul id="recommendationsList">
                    <li>Cognitive function appears normal based on MoCA screening</li>
                    <li>Continue regular cognitive health monitoring</li>
                    <li>Maintain healthy lifestyle habits for brain health</li>
                    <li>Consider annual cognitive screening as appropriate</li>
                </ul>
            </div>

            <div class="disclaimer">
                <strong>Important Disclaimer:</strong> The MoCA is a cognitive screening tool and should not be used as the sole basis for clinical diagnosis. Results should be interpreted by qualified healthcare professionals in conjunction with clinical assessment, medical history, and other relevant factors. If cognitive concerns persist, further neuropsychological evaluation may be warranted.
            </div>

            <div class="controls">
                <button class="btn btn-primary" onclick="calculateFinalScore()" id="calculateBtn">
                    🧮 Calculate Final Score
                </button>
                <button class="btn btn-secondary" onclick="printSummary()" id="printBtn">
                    🖨️ Print Summary
                </button>
                <button class="btn btn-warning" onclick="exportResults()" id="exportBtn">
                    📄 Export Results
                </button>
                <button class="btn btn-success" onclick="saveAssessment()" id="saveBtn">
                    💾 Save Assessment
                </button>
                <button class="btn btn-secondary" onclick="resetAssessment()" id="resetBtn">
                    🔄 New Assessment
                </button>
            </div>

            <div class="print-summary" id="printSummary" style="display: none;">
                <h3>Assessment Summary for Printing</h3>
                <p>Date: <span id="assessmentDate"></span></p>
                <p>Total Score: <span id="printTotalScore"></span>/30</p>
                <p>Interpretation: <span id="printInterpretation"></span></p>
            </div>

            <div class="navigation">
                <button class="btn btn-secondary" onclick="goToPreviousStep()">
                    ← Previous Step
                </button>
                <button class="btn btn-success" onclick="finishAssessment()">
                    ✅ Finish Assessment
                </button>
            </div>
        </div>
    </div>

    <script>
        // Sample scores - these would normally come from previous steps
        let domainScores = {
            visuospatial: 5,
            naming: 3,
            memory: 0, // No points for registration
            attention: 6,
            language: 3,
            abstraction: 2,
            delayedRecall: 5,
            orientation: 6
        };

        let educationLevel = 16; // Sample education level
        let assessmentComplete = false;

        function calculateFinalScore() {
            // Calculate total raw score
            const rawTotal = Object.values(domainScores).reduce((sum, score) => sum + score, 0);
            
            // Apply education adjustment
            const educationAdjustment = educationLevel <= 12 ? 1 : 0;
            const adjustedTotal = Math.min(30, rawTotal + educationAdjustment);
            
            // Update display
            document.getElementById('totalScore').textContent = rawTotal;
            document.getElementById('adjustedScore').textContent = adjustedTotal;
            document.getElementById('finalTotalScore').innerHTML = `<strong>${adjustedTotal}</strong>`;
            
            // Update education text
            if (educationLevel <= 12) {
                document.getElementById('educationText').textContent = 
                    `Education: ${educationLevel} years (≤12) - Add 1 point`;
            } else {
                document.getElementById('educationText').textContent = 
                    `Education: ${educationLevel} years (>12) - No adjustment`;
            }
            
            // Update domain scores
            updateDomainScores();
            
            // Update interpretation
            updateInterpretation(adjustedTotal);
            
            // Update recommendations
            updateRecommendations(adjustedTotal);
            
            // Show controls
            document.getElementById('calculateBtn').style.display = 'none';
            document.getElementById('printBtn').style.display = 'inline-flex';
            document.getElementById('exportBtn').style.display = 'inline-flex';
            document.getElementById('saveBtn').style.display = 'inline-flex';
            
            assessmentComplete = true;
            
            // Trigger animations
            animateScoreReveal();
        }

        function updateDomainScores() {
            // Update table scores
            document.getElementById('visuospatialScore').textContent = domainScores.visuospatial;
            document.getElementById('namingScore').textContent = domainScores.naming;
            document.getElementById('memoryScore').textContent = domainScores.memory;
            document.getElementById('attentionScore').textContent = domainScores.attention;
            document.getElementById('languageScore').textContent = domainScores.language;
            document.getElementById('abstractionScore').textContent = domainScores.abstraction;
            document.getElementById('delayedRecallScore').textContent = domainScores.delayedRecall;
            document.getElementById('orientationScore').textContent = domainScores.orientation;
            
            // Update domain cards
            document.getElementById('domainVisuo').textContent = domainScores.visuospatial;
            document.getElementById('domainNaming').textContent = domainScores.naming;
            document.getElementById('domainAttention').textContent = domainScores.attention;
            document.getElementById('domainLanguage').textContent = domainScores.language;
            document.getElementById('domainAbstraction').textContent = domainScores.abstraction;
            document.getElementById('domainRecall').textContent = domainScores.delayedRecall;
            document.getElementById('domainOrientation').textContent = domainScores.orientation;
            
            // Update colors based on performance
            updateDomainColors();
        }

        function updateDomainColors() {
            const maxScores = {
                visuospatial: 5,
                naming: 3,
                attention: 6,
                language: 3,
                abstraction: 2,
                delayedRecall: 5,
                orientation: 6
            };
            
            const domains = ['domainVisuo', 'domainNaming', 'domainAttention', 'domainLanguage', 
                           'domainAbstraction', 'domainRecall', 'domainOrientation'];
            const domainKeys = ['visuospatial', 'naming', 'attention', 'language', 
                              'abstraction', 'delayedRecall', 'orientation'];
            
            domains.forEach((domainId, index) => {
                const element = document.getElementById(domainId);
                const score = domainScores[domainKeys[index]];
                const maxScore = maxScores[domainKeys[index]];
                const percentage = (score / maxScore) * 100;
                
                element.className = 'domain-score ' + getScoreClass(percentage);
            });
        }

        function getScoreClass(percentage) {
            if (percentage >= 90) return 'score-excellent';
            if (percentage >= 75) return 'score-good';
            if (percentage >= 50) return 'score-warning';
            return 'score-error';
        }

        function updateInterpretation(totalScore) {
            const interpretationElement = document.getElementById('interpretationContent');
            
            if (totalScore >= 26) {
                interpretationElement.className = 'interpretation-content interpretation-normal';
                interpretationElement.innerHTML = `
                    <strong>Normal Cognitive Function</strong><br>
                    Score ≥ 26 indicates normal cognitive performance. No significant cognitive impairment detected.
                `;
            } else if (totalScore >= 18) {
                interpretationElement.className = 'interpretation-content interpretation-mild';
                interpretationElement.innerHTML = `
                    <strong>Mild Cognitive Impairment Possible</strong><br>
                    Score ${totalScore}/30 suggests possible mild cognitive impairment. Further evaluation may be warranted.
                `;
            } else {
                interpretationElement.className = 'interpretation-content interpretation-moderate';
                interpretationElement.innerHTML = `
                    <strong>Significant Cognitive Concerns</strong><br>
                    Score ${totalScore}/30 indicates significant cognitive concerns. Clinical evaluation recommended.
                `;
            }
        }

        function updateRecommendations(totalScore) {
            const recommendationsList = document.getElementById('recommendationsList');
            let recommendations = [];
            
            if (totalScore >= 26) {
                recommendations = [
                    'Cognitive function appears normal based on MoCA screening',
                    'Continue regular cognitive health monitoring',
                    'Maintain healthy lifestyle habits for brain health',
                    'Consider annual cognitive screening as appropriate'
                ];
            } else if (totalScore >= 18) {
                recommendations = [
                    'Consider referral for comprehensive neuropsychological evaluation',
                    'Monitor cognitive function more closely',
                    'Assess for reversible causes of cognitive impairment',
                    'Implement cognitive health strategies',
                    'Follow up in 6-12 months or sooner if concerns arise'
                ];
            } else {
                recommendations = [
                    'Urgent referral for comprehensive cognitive evaluation recommended',
                    'Assess for treatable causes of cognitive impairment',
                    'Consider safety evaluation and support needs',
                    'Involve family/caregivers in care planning',
                    'Close monitoring an